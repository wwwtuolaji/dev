<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>贷款直通车</title>
    <script type="text/javascript" src="{res file=js/js_plugin/jquery-1.11.1.min.js}"></script>
    <link rel="stylesheet" href="{res file=css/base.css}"/>
    <link rel="stylesheet" href="{res file=css/loan.css}"/>
    <script type="text/javascript" src="{res file=js/layer/layer.js}"></script>
    {$_head_tags}
</head>
<body>

    <div class="h">
        <div class="w">{include file=nav.html}</div>
    </div>
    <div class="main applymain">
        <div class="wrap">
            <!-- <div class="dk-bread">
            <a href="/">贷款首页</a> <em class="sw">&gt;</em>
            贷款申请
        </div>
        -->
        <div class="loan-apply clearfix">
            <div class="hd">
                <h3>免费申请</h3> <i class="icon icon-cur"></i>
                <span class="fr">
                    <span class="c-blue">声明：</span>
                    您填写的信息将只作为贷款产品推荐使用，不会以任何形式泄露给其他人员或机构
                </span>
            </div>
            <div class="bd">
                <div class="step clearfix">
                    <ul>
                        <li class="current">
                            <div class="step1 pngbg">1、基本信息</div>
                        </li>
                        <li>
                            <div class="step2 pngbg">2、完善信息</div>
                        </li>
                        <li>
                            <div class="step3 pngbg">3、申请成功</div>
                        </li>
                    </ul>
                </div>
                <div class="apply-form fl">
                    <form id="applyForm" method="POST" action="index.php?app=index&act=loan_i">
                        <div class="item">
                            <div class="label">贷款金额：</div>
                            <input maxlength="5" id="money" value="{$loan.money}" onafterpaste="this.value=this.value.replace(/\D/g,'')" onkeyup="this.value=this.value.replace(/[^0-9|\.^]/g,'')" class="ui-input" placeholder="请输入贷款金额，例如：0.8" title="请输入贷款金额，例如：0.8" name="money" type="text">
                            <div class="text">万元</div>
                        </div>
                        <div class="item">
                            <div class="label">您的姓氏：</div>
                            <input name="first_name" value="{$loan.first_name}" onafterpaste="this.value=this.value.replace(/[^\u4E00-\u9FA5]/g,'')" onchange="this.value=this.value.replace(/[^\u4E00-\u9FA5]/g,'')" maxlength="2" class="ui-input" placeholder="请输入1-2个汉字，例如：李、欧阳"title="请输入1-2个汉字，例如：李、欧阳" type="text">
                            <div style="float:left;line-height:40px;padding-left: 10px;" id="sex">
                            {if empty($loan)}
                                <label>
                                    <input value="0" name="sex" checked="checked" type="radio">先生</label>
                                <label>
                                    <input value="1" name="sex" type="radio">女士</label>
                            {else}
                                <label>
                                    <input value="0" name="sex" {if $loan.sex eq 0}checked="checked" {/if} type="radio">先生</label>
                                <label>
                                    <input value="1" name="sex" {if $loan.sex eq 1}checked="checked" {/if}type="radio">女士</label>
                            {/if}
                            </div>
                        </div>

                        <div class="item">
                            <div class="label">联系手机：</div>
                            <input onkeyup="this.value=this.value.replace(/[^0-9^]/g,'')" name="phone" value="{$loan.phone}" maxlength="11" class="ui-input input-mobile" title="请输入11位手机号码" placeholder="请输入11位手机号码" type="text"></div>
                        <div class="item">
                            <div class="label">邮箱账号：</div>
                            <input  name="email" value="{$loan.email}" maxlength="30" class="ui-input email" placeholder="请输入正确邮箱账号" title="请输入正确邮箱账号" type="text"></div>

                        <div class="item">
                            <div class="label">图形验证码：</div>
                            <input name="authCode" maxlength="4" class="ui-input input-mobile" placeholder="4位图形验证码" id="authCode" style="width:120px;" type="text">
                            <a href="javascript:change_captcha($('#captcha'));" class="renewedly" title="看不清？换一张">
                                <img id="captcha" style="margin-left:10px;float:left;height:34px;"src="index.php?app=captcha&amp;15749"alt="看不清？换一张" ></a>
                                                       </div>

                        <div class="item">
                            <div class="label">验&nbsp;证&nbsp;码：</div>
                            <input  name="smsCode" onkeyup="this.value=this.value.replace(/[^0-9]/g,'')" maxlength="6" style="width:150px;" class="ui-input input-code" placeholder="请输入验证码" type="text">
                            <input  value="获取验证码" class="ui-btn btn-code" id="sendYzm" type="button">
                            <div id="notes" class="tip-code2"style="text-indent: 152px;line-height: 30px;" >邮箱如果没有收到信息，请查看回收站</div>


                        </div>
                        <div class="item">
                            <div class="label"></div>
                            <input name="back_token"  value="{$loan.token}" type="hidden">
                            <input name="loan_id"  value="{$loan.loan_id}" type="hidden">
                            <input id="but_submit" class="ui-btn btn-orange btn-next" value="下一步" type="button">
                            <input type="hidden" value="{$token}" name="token" />
                        </div>
                    </form>
                </div>
                <div class="intro fl">
                    <ul>
                        <li> <i class="icon icon-1"></i>
                            <div class="text">
                                <span class="f16 c-333">利率低</span>
                                <br>会员贷款利率低于小额市场利率的20%</div>
                        </li>
                        <li>
                            <i class="icon icon-2"></i>
                            <div class="text">
                                <span class="f16 c-333">放贷快</span>
                                <br>与福元运通投资融资理财服务平台合作，使您最快拿到钱</div>
                        </li>
                        <li>
                            <i class="icon icon-3"></i>
                            <div class="text">
                                <span class="f16 c-333">额度高</span>
                                <br>最高可获得上限为100万元的短期融资</div>
                        </li>
                        <li>
                            <i class="icon icon-4"></i>
                            <div class="text">
                                <span class="f16 c-333">全保密</span>
                                <br>资料只作为贷款产品推荐使用，绝不会泄露给第三方</div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
 var par_fun = new RegExp("[\\w!#$%&'*+/=?^_`{|}~-]+(?:\\.[\\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\\w](?:[\\w-]*[\\w])?\\.)+[\\w](?:[\\w-]*[\\w])?");
    function change_captcha(jqObj){
        jqObj.attr('src', 'index.php?app=captcha&' + Math.round(Math.random()*10000));
    }
    /*验证码获取*/
    var submit_btn = true;
    $("#sendYzm").click(function(event) {
        
        var email_str = $(".email").val();
        if(check_status($(".email"))==false){
            layer.msg('邮箱账号格式错误',{icon: 2},{time:10});
            return;
        };
        captcha_code = $("#authCode").val();
        if(check_status($("#authCode"))==false){   
         //校验验证码
             layer.msg('图形验证码为空',{icon: 2},{time:10});
             return;
        }

        if(check_status($("#authCode"))==false){

        }
        if (submit_btn==false) {
            layer.msg('请稍后点击，邮件正在发送中',{icon: 2},{time:10});
            return;
        }
       submit_btn = false;
        $.ajax({
            url: 'index.php?app=captcha&act=check_captcha',
            type: 'GET',
            dataType: 'json',
            data: {captcha: captcha_code},
            success:function(data){
                
                if (data==false) {
                    layer.msg('图形验证码输入错误',{icon: 2},{time:10});
                    return;
                }else{
                   //发送邮件
                       $.ajax({
                           url: 'index.php?app=index&act=send_code',
                           type: 'POST',
                           dataType: 'json',
                           data: {email_str: email_str},
                           success:function(out_data){
                              submit_btn = true;
                              layer.msg('邮件发送成功请查收',{icon: 1},{time:15});

                           }
                       })
                     
                }
            }
        })
       
    });
    /*更改导航栏选中*/
    $(function(){
       $(".nav li").attr("class","");  
       $(".nav li:eq(6)").attr("class","center");  
    });
    $("#applyForm .ui-input").blur(function(event) {
        check_status($(this));
    });
   
    $("#but_submit").click(function(){
        
       
        check_status($("#money")); 
        var status_check =true;
        $.each($(".ui-input"),function(index,e){
            if(check_status($(e))===false){
                status_check=false;
            }
        });
        if (status_check==false) {
            layer.msg('请修改警告框中的内容',{icon: 2},{time:10});
            return;
        }
        
        var input_code = $(".input-code").val();
        $.ajax({
            url: 'index.php?app=index&act=check_code',
            type: 'POST',
            dataType: 'json',
            data: {input_code:input_code},
            success:function(out_data){
                 
                if (out_data.code!=0) {
                    $("input-code").css({
                        background: '#fef4eb none repeat scroll 0 0',
                        border: '1px solid #ff8e33',
                    });
                    layer.msg('验证码输入错误',{icon: 2},{time:10});
                   
                    return;
                }else{
                    $("form").submit();
                }

            }
        })
       

    });
   

    function check_status(e){
      var var_temp =   e.val();
      if (!var_temp) {
            e.css({
                background: '#fef4eb none repeat scroll 0 0',
                border: '1px solid #ff8e33',
            });
            return false;
      }else if(e.attr('name') =="phone"&&var_temp.length !=11){
             e.css({
                background: '#fef4eb none repeat scroll 0 0',
                border: '1px solid #ff8e33',
            });
            return false;
      }else if (e.attr('name') =="email"&& par_fun.test(var_temp)==false) {
            e.css({
                background: '#fef4eb none repeat scroll 0 0',
                border: '1px solid #ff8e33',
            });
            return false;
      }else{
         e.css({
                background: '#fff none repeat scroll 0 0',
                border: '1px solid #ccc',
            });
     
      return true;

      }

      
    }

   

   
</script>
</body>
</html>
