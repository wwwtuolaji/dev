{include file=tea_common.html}

<link rel="stylesheet" type="text/css" href="{res file=css/transaction.css}">
<div class="w" style="overflow: hidden;">
    <!--分类菜单-->
    <div class="fl tea-inner">
        <div class="tea-box">
            <div class="tea-menu">
                <dl>
                    <dt>行情参考</dt>
                    <dd>
                        <a href="#">当年</a>
                    </dd>
                    <dd>
                        <a href="#">新茶</a>
                    </dd>
                    <dd>
                        <a href="#">中期</a>
                    </dd>
                </dl>
                <dl>
                    <dt>批发</dt>
                    <dd>
                        <a href="#">七彩云南</a>
                    </dd>
                    <dd>
                        <a href="#">庆丰祥</a>
                    </dd>
                    <dd>
                        <a href="#">滇红茶</a>
                    </dd>
                </dl>
                <dl>
                    <dt>零售</dt>
                    <dd>
                        <a href="#">整片</a>
                    </dd>
                    <dd>
                        <a href="#">微克</a>
                    </dd>
                    <dd>
                        <a href="#">散茶</a>
                    </dd>
                </dl>

            </div>
            <div class="apply_transaction" >
                <form id="apply_transaction_form"  method="post">
                <dl>
                    <dt>配货申请</dt>
                    <dd>
                        <label>产品名称：</label>
                        <select name="goods_id"required >
                        {foreach from=$transaction_apply item=apply}
                            <option value="{$apply.goods_id}">{$apply.goods_name}</option>
                        {/foreach}
                        </select>
                    </dd>
                    <dd>
                        <label name="produce">产品数量：</label>
                        <input name="produce_count" id="produce_count"type="text" onkeyup="this.value=this.value.replace(/\D/g,'')"  onafterpaste="this.value=this.value.replace(/\D/g,'')" maxlength="4" required>
                    </dd>
                    <dd>
                        <label>产品价格：</label>
                        <input name="produce_price" id="produce_price"type="text" required>
                        <input type="hidden" name="token" value="{$token}" >
                    </dd>
                    <dd><a href="javascript:;" id="apply_transaction_btn">提交</a></dd>
                </dl>
                </form>
                <div class="bt_content"><span>已申请数量：</span><a id="show_count"href="javascript:;" >{$apply_count}</a> </div>
            </div>
        </div>
    </div>
    <!--右侧内容-->
    <!--茶叶风向标-->
    <div class="fl cyfxb">{include file="drogue.html"}</div>
    <!--交易详情-->
    <div class="transaction_des">
        <div class="fl">
            <div class='top_tit'>
                <span>交易详情</span>
            </div>
            <div class='transaction_con' >
                <ul class='tit_des' >
                    <li class="first">买/卖</li>
                    <li>交易单号</li>
                    <li>商品名称</li>
                    <li class='top_tra_price'>交易价格(元)</li>
                    <li>数量(片/件)</li>
                    <li>挂单时间</li>
                </ul>
                <div id="oDiv" style="height: 150px;overflow: hidden;width: 990px;">
                    <ul class='trans_bot_con'id="oUl">
                       
                        {foreach from=$transaction_arr item=transaction_}
                        <li class='buy_goods_transaction'>
                            <a href="javascript:;" sn="{$transaction_.transaction_sn}" goods_id="{$transaction_.goods_id}"goods_name="{$transaction_.goods_name}" goods_type="{$transaction_.type_des}">
                                <ul>
                                    {if $transaction_.transaction_status eq 1}
                                    <li class='tra'style='color: green'>卖</li>
                                    {else}
                                    <li class='tra'style='color: red'>买</li>
                                    {/if}
                                    <li class='tra_sn'>{$transaction_.temp_sn}</li>
                                    <li class='tra_name'>{$transaction_.goods_name}</li>
                                    <li class='tra_price'>￥{$transaction_.transaction_price}</li>
                                    <li class='tra_num'>{$transaction_.transaction_count}</li>
                                    <li class='tra_time'>{$transaction_.date_des}</li>
                                </ul>
                            </a>
                        </li>

                        {/foreach}
                       
                    </ul>
                </div>
            </div>

        </div>
    </div>
    <!--交易模块-->
    <div class="transaction">
        <div class='share_price fl'>
            <ul>
                <li>
                    <span class='share_des'>开盘价：</span>
                    <span class="share_price_count">--</span>
                </li>
                <li>
                    <span class='share_des'>最新价：</span>
                    <span class="share_price_count">--</span>
                </li>
                <li>
                    <span class='share_des'>最高价：</span>
                    <span class="share_price_count">--</span>
                </li>
                <li>
                    <span class='share_des'>最低价：</span>
                    <span class="share_price_count">--</span>
                </li>
                <li>
                    <span class='share_des'>涨幅价：</span>
                    <span class="share_price_count">--</span>
                </li>
                <li>
                    <span class='share_des'>涨跌价：</span>
                    <span class="share_price_count">--</span>
                </li>
                <li>
                    <span class='share_des'>涨停价：</span>
                    <span class="share_price_count">--</span>
                </li>
                <li>
                    <span class='share_des'>跌停价：</span>
                    <span class="share_price_count">--</span>
                </li>
                <li>
                    <span class='share_des'>昨日收盘价：</span>
                    <span class="share_price_count">--</span>
                    <input style="display: none" id='sell_count'/>
                </li>
            </ul>
        </div>
        <!--交易申请-->
        <div class="buysell fl">
            <h3>交易申请</h3>
            <form method="post" id="myForm" >
            <p> 产品:<input type="text" id='serch_content' class="tran_in" name="goods_name" style="border:1px solid #aaa;height: 30px; width: 160px;margin-left: 5px;">
            </p>
                <input type="text" id='goods_id' class="tran_in" name="goods_id" style="display: none">
                <p>
                    年份:
                    <span id='tea_type'>暂无</span>
                    <input type="text" id='tea_type_hidden' name="tea_type" style="display: none"></p>
                市值：
                <span  id='tea_price'style="font: 700 20px/40px 'Microsoft Yahei';color: #a00;"></span>

                <br/>
                <label >
                    <input name="fruit" type="radio"checked_cho='false'value="1" checked="checked"id="sell_in" >买入</label>
                <label >
                    <input name="fruit" type="radio" id='sell_out'value="2">卖出</label>
                <br/>
                <label >
                    价格:
                    <input  type="text" class="tran_in" id='input_price'name="transaction_price" style="width: 90px;border:1px solid #aaa;"autocomplete="off"></label>

                <!--  <label id='fanwei'style="display: none" >
                <br/>
                允许成交浮动范围0.
                <input type="text" class="tran_in" name="firstname" style="width: 17px; border:1px solid #aaa;margin-left: 1px;"maxlength='1'>
                <span>%</span>
            </label>
            -->
            <br/>
            数量:
            <input readonly=false type="text" id='count_tran_in'class="tran_in" name="transaction_count" style="width: 90px;border:1px solid #aaa;"maxlength='5' autocomplete="off">
            <br/>
            <input  id='confirm_order'type="checkbox" value="" />
            下单确认
            <br/>
            <input style="display: none;" id='confirm_pwd' name='confirm_pwd' type='password'>
            <input type="hidden" name="token" id="token" value="{$token}">
            <div style="text-align:center;">
                <input type='button' id='submit_aply' style="width: 150px;font: 700 20px/35px 'Microsoft Yahei';border:1px solid #888;"value='提交申请'></div>
        </form >
    </div>
    <!--交易持仓导航栏-->
    <div id='transaction_nav' style="float: left;height: 300px;border:1px solid #aaa;">
        <div class="chicang">
            <ul>

                <li class="center-jy">
                    <a id='mingxi_transaction'>持仓明细</a>
                </li>
                <li>
                    <a id='agent_transaction'>委托交易</a>
                </li>
                <li>
                    <a id='today_transaction'>历史成交</a>
                </li>
            </ul>
        </div>
        <!--持仓明细-->
        <div id="mingxi" class="transaction_click">
            <div class="mingxi" >
                <ul>
                    <li class="mingxi-produce">产品</li>
                    <li>年份</li>
                    <li>持仓量</li>
                    <li>持仓成本</li>
                    <li>持仓均价</li>
                    <li>当前价格</li>
                    <li class='particular'>浮动盈亏</li>
                    <li>操作</li>
                </ul>
            </div>
            <div class="mingxi_bot">
                <ul>
                    {foreach from=$particulars item=particular}
                    <li>
                        <ul>
                            <li class="mingxi_name" title="{$particular.goods_name}">{$particular.goods_name}</li>
                            <li class="mingxi_date">{$particular.type_des}</li>
                            <li class="mingxi_num">{$particular.goods_count}</li>
                            <li class="mingxi_price_warehouse">￥{$particular.transaction_price}</li>
                            <li class="mingxi_price_pre">￥{$particular.pre_price}</li>
                            <li class="mingxi_price_current">￥{$particular.current_price}</li>
                            {if $particular.fdyk gte 0}
                            <li class="mingxi_price_range" style="color: red">↑ {$particular.fdyk}%</li>
                            {else}
                            <li class="mingxi_price_range" style="color: green">↓ {$particular.fdyk}%</li>
                            {/if}
                            <li class="mingxi_sell_btn">
                                <button goods_id="{$particular.goods_id}">卖出</button>
                            </li>
                        </ul>
                    </li>
                    {/foreach}
                </ul>
            </div>
        </div>
        <!--持仓明细结束-->
        <!--委托交易-->
        <div id='agent' class="transaction_click"style="display: none">
            <div class="mingxi agent" >
                <ul>
                    <li class="mingxi-produce">产品</li>
                    <li class="agent_nianfen">年份</li>
                    <li class="agent_count">数量</li>
                    <li>单价</li>
                    <li>总价</li>
                    <li class="agent_buy">买/卖</li>
                    <li class='agent_date'>委托时间</li>
                    <li class='agent_cancel'>操作</li>
                </ul>
            </div>
            <div class="agent_bot">
                <ul >
                    {foreach from=$agent_transaction item=transaction}
                    <li>
                        <ul>
                            <li class="mingxi_name" title="{$transaction.goods_name}">{$transaction.goods_name}</li>
                            <li class="mingxi_date">{$transaction.type_des}</li>
                            <li class="mingxi_num">{$transaction.transaction_count}</li>
                            <li class="mingxi_price_warehouse">￥{$transaction.transaction_price}</li>
                            <li class="mingxi_price_total">￥{$transaction.total_count}</li>
                            <li class="mingxi_price_pre">{$transaction.status_des}</li>
                            <li class="agent_price_current">{$transaction.format_time}</li>
                            <li class="agent_cancel">
                                <button transaction_id="{$transaction.transaction_sn}">取消</button>
                            </li>
                        </ul>
                    </li>
                    {/foreach}
                </ul>
            </div>
        </div>
        <!--委托交易结束-->
        <!--今日成交-->
          <div id='today' class="transaction_click"style="display: none">
            <div class="mingxi agent" >
                <ul>
                    <li class="mingxi-produce">产品</li>
                    <li class="agent_nianfen">年份</li>
                    <li class="agent_count">数量</li>
                    <li>单价</li>
                    <li>总价</li>
                    <li class="agent_buy">买/卖</li>
                    <li class='agent_date'>交易时间</li>
                    <li class='agent_cancel'>状态</li>
                </ul>
            </div>
            <div class="agent_bot">
                <ul >
                    {foreach from=$history_transaction item=hisory}
                    <li>
                        <ul>
                            <li class="mingxi_name" title="{$hisory.goods_name}">{$hisory.goods_name}</li>
                            <li class="mingxi_date">{$hisory.type_des}</li>
                            <li class="mingxi_num">{$hisory.transaction_history_count}</li>
                            <li class="mingxi_price_warehouse">￥{$hisory.transaction_price}</li>
                            <li class="mingxi_price_total">￥{$hisory.total_count}</li>
                            <li class="mingxi_price_pre">{$hisory.status_des}</li>
                            <li class="agent_price_current">{$hisory.format_time}</li>
                            <li class="agent_cancel">
                                <span>已成交</span>
                              
                            </li>
                        </ul>
                    </li>
                    {/foreach}
                </ul>
            </div>
        </div>

        <!--今日成交结束-->
         </div>
    <div id='prodece_out' class='procduce' style="display:none;">
        <div id='produce_tit'  style="float: left;height: 30px;border:1px solid #aaa; width: 765px;overflow: hidden;">
            <div class='tea_serch_tit'>茶叶检索</div>
            <span class="fr" id='close_produce'>关闭</span>
        </div>
        <div id='produce_con'style="float: left;height: 268px;border:1px solid #aaa; width: 765px;overflow: auto;">
            <table>

                    <input id="user_id" user_id="{$user_id}"value="0" type="text" style="display: none">
            </table>
        </div>
    </div>
    <!--茶产品详情 -->
    <div id='prodece_info'class='procduce'style="display: none;" >
        <div class='fl baidu_echars' >
            <!--start -->
            <div id="saveEchart">
                <div class="container" id="main" style="height:270px;width:540px;margin: 0 auto;"></div>
            </div>
            <!--end-->
            <div style="margin-top: 10px;height: 30px;">
                <div class="search_price_drogue" style="text-align: center;">
                    <form method="post" action="" onsubmit="return checktime()">
                        <input size="10" value="{$temp_start_time}" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" name="begin_day" id="begin_day1" class="inputbg5" type="text">
                        &nbsp;至&nbsp;&nbsp;
                        <input size="10" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" value="{$temp_end_time}" name="end_day" id="end_day1" class="inputbg5" type="text">
                        <input style="background: #FF7F50 none repeat scroll 0 0; border: 1px solid #FF7F50; border-radius: 3px; color: #fff; cursor: pointer; height: 25px; line-height: 22px; margin-left: 5px; text-align: center; width: 41px;"class="submitnow" value="查询"id="commit_date" type="button">
                        <input name="size" value="10" type="hidden">
                        <input name="sort_time" value="0" type="hidden"></form>
                </div>
            </div>

        </div>
        <div class='transaction_info'>
            <table id='pan_table'>
                <tr>
                    <td class="first_tit" rowspan="5">卖盘</td>
                    <td class='order_dian'>5</td>
                    <td class="cent_dian">3.454</td>
                    <td class='final_dian'>45</td>
                    <td class='close_cur' >
                        <span class="fr" id='close_produce_re'>关闭</span>
                    </td>
                </tr>
                <tr>
                    <td class='order_dian'>4</td>
                    <td class="cent_dian">3.454</td>
                    <td class="final_dian">23</td>
                </tr>
                <tr>
                    <td class='order_dian'>3</td>
                    <td class="cent_dian">3.454</td>
                    <td class="final_dian">23</td>
                </tr>
                <tr>
                    <td class='order_dian'>2</td>
                    <td class="cent_dian">3.454</td>
                    <td class="final_dian">23</td>
                </tr>
                <tr>
                    <td class='order_dian'>1</td>
                    <td class="cent_dian">3.454</td>
                    <td class="final_dian">23</td>
                </tr>
                <tr class="ge">
                    <td colspan="100">
                        <span></span>
                    </td>
                </tr>
                <tr>
                    <td class="first_tit" rowspan="5">买盘</td>
                    <td class="order_dian">1</td>
                    <td class="cent_dian">3.454</td>
                    <td class='final_dian'>45</td>
                </tr>
                <tr>
                    <td class="order_dian">2</td>
                    <td class="cent_dian">3.454</td>
                    <td class="final_dian">23</td>
                </tr>
                <tr>
                    <td class="order_dian">3</td>
                    <td class="cent_dian">3.454</td>
                    <td class="final_dian">23</td>
                </tr>
                <tr>
                    <td class="order_dian">4</td>
                    <td class="cent_dian">3.454</td>
                    <td class="final_dian">23</td>
                </tr>
                <tr>
                    <td class="order_dian">5</td>
                    <td class="cent_dian">3.454</td>
                    <td class="final_dian">23</td>
                </tr>
            </table>
        </div>
        <!--   <span class="fr" id='close_produce_re'>关闭</span>
    -->
</div>
</div>
<div>
<!--调用商城信息-->
</div>
</div>
<!--底部-->
{include file="footer.html" }
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/jquery.validate.min.js"></script>
   
<script type="text/javascript">
    /*验证js函数设置*/
    $('#produce_price').on('keyup',function(){
        var temp=$(this).val().replace(/[^\d.]/g,''); 
        $(this).val(temp);
    });
    $("#apply_transaction_btn").click(function(event) {
        produce_count = $("#produce_count").val();
        produce_price = $("#produce_price").val();
        if (!produce_count||!produce_price) {
            alert('请填完整信息');
            return;
        }
        $("#apply_transaction_form").attr('action',"?app=index&act=transaction_apply");
        $("#apply_transaction_form").submit();
          
    });
</script>
<script type="text/javascript" src="{res file=js/transaction.js}"></script>
<script type="text/javascript">
     /* {if $apply_arr}*/
     var apply_arr = JSON.parse('{$apply_arr}');
        var c=0;
        var temp_apply_arr ='';
         $.each(apply_arr, function(index, val) {
             this.apply_time=new Date(parseInt(this.apply_time) * 1000).toLocaleString().replace(/:\d{1,2}$/,' '); 
              console.log(this);
              switch(this.approval_status){
                case '-1':
                    this.approval_status = '未完成';
                    break;
                case '1':
                    this.approval_status = '通过';
                    break;
                case '0':
                    this.approval_status = '被拒绝';
                    break;
                default:
                     this.approval_status = '未知';
              }
              if (!this.approval_comments) {
                this.approval_comments ='暂无';
              }

              temp_apply_arr+='<tr style="width:100%;font:100 14px/36px \'MicroSoft Yahei\'"><td style="text-align:center">'+c+'</td><td><span title="'+this.goods_name+'">'+this.goods_name+'</span></td><td style="text-align:center">'+this.produce_count+'</td><td style="text-align:center">'+this.produce_price+'</td><td style="text-align:center"><span>'+this.apply_time+'</span></td><td style="text-align:center">'+this.approval_status+'</td><td style="text-align:center"><span class="com"title="'+this.approval_comments+'">'+this.approval_comments+'</span></td></tr>';

             c++;
         });
    /*{/if}*/
    $("#show_count").click(function(event) {
        var show_count = $(this).html();
        show_count = parseInt(show_count);
        if (show_count>0) {
            var show_content = '\<\div style="width:100%; font:400 16px/20px \'MicroSoft Yahei\'; margin:20px auto; color:#aaa;"> <table border="1" style="border-collapse:collapse;width:100%;"bordercolor="#aaa"><tr ><th>序号</th><th>商品名称</th><th>数量</th><th>价格</th><th>申请时间</th><th>进度</th><th>备注</th></tr>';
            show_content =  show_content +temp_apply_arr+'</table>\<\/div>';
             layer.open({
                  type: 1,//0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）。 若你采用layer.open({type: 1})方式调用，则type为必填项（信息框除外）
                  title: ['申请进度信息', 'font-size:18px;'],//如果你不想显示标题栏，你可以title: false  不想自定义样式 title：'标题'
                  area: ['700px', '400px'],//弹出层的宽高 默认自适应
                  //offset: ['100px', '200px'],//默认垂直水平居中  当您top、left都要定义时，你可以offset: ['100px', '200px']。除此之外，你还可以定义offset: 'rb'，表示右下角。其它的特殊坐标，你可以自己计算赋值。
                  shade: [0.8, '#393D49'],//弹层外区域。默认是0.3透明度的黑色背景（'#000'）。如果你想定义别的颜色，可以shade: [0.8, '#393D49']；如果你不想显示遮罩，可以shade: 0
                  shadeClose: false, //如果你的shade是存在的，那么你可以设定shadeClose来控制点击弹层外区域关闭。默认值false
                  closeBtn: 1,//layer提供了两种风格的关闭按钮，可通过配置1和2来展示，如果不显示，则closeBtn: 0
                  btn: ['关闭'],
                  time: false,//默认不会自动关闭。当你想自动关闭时，可以time: 5000，即代表5秒后自动关闭
                  shift:2,//我们的出场动画全部采用CSS3目前shift可支持的动画类型有0-6
                  maxmin: true,//该参数值对type:1和type:2有效
                 yes: function(index, layero){
                     //按钮1的回调
                     layer.close(index);
                 }, 
                  cancel: function(){ 
                     
                     /*alert("点击右上角关闭的回调");*/
                  },
                  /*content: '\<\div style="padding:60px;">自定义内容\<\/div>'*/
                  content: show_content
              });
        }else{
            layer.alert('您还没有任何相关的信息！', {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            layer.close(index);
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
        }
    });
    $(function(){
        //end;
        $(".nav li").attr("class","");
        $(".nav li a:contains(交易)").attr("class","center");
        $('#submit_aply').on('click', function(){
            serch_content=$("#serch_content").val();
            if (serch_content==undefined||serch_content=='') {
               layer.alert('该产品不存在！无法进行下一步操作！', {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            layer.close(index);
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                    return; 
            }
            //获取买卖操作方式
            var choose=get_choose();
            //检查价格是否存在
            input_price=$('#input_price').val();
            count_tran_in=$('#count_tran_in').val();
            serch_content=$('#serch_content').val();
            if (input_price==''||count_tran_in=='') {
                layer.alert('请把信息填写完整', {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            layer.close(index);
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                return;
            }
            count_tran_in=parseInt(count_tran_in);
            input_price=parseFloat(input_price);
            total_count=count_tran_in*input_price;
            total_count=total_count*100;
            total_count=Math.ceil(total_count);
            total_count=total_count/100;
            //判断是否选中checkbox
             if(!$('#confirm_order').is(':checked')){
                layer.alert('请选中确认框！', {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            layer.close(index);
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                return;
             }
            goods_id=$('#goods_id').val();
            if(choose==2){
                //卖出
                $.ajax({
                    url: 'index.php?app=index&act=check_current_stock',
                    type: 'POST',
                    dataType: 'json',
                    data: {goods_id: goods_id},
                    success:function(outdata){
                        if (outdata.code!=0) {
                           alert(outdata.message); 
                           return;
                        }
                        $(this).attr("disabled", true); 
                          //open弹出一个页面层
                        layer.open({
                          type: 1,//0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）。 若你采用layer.open({type: 1})方式调用，则type为必填项（信息框除外）
                          title: ['【卖出】茶叶交易订单确认', 'font-size:18px;'],//如果你不想显示标题栏，你可以title: false  不想自定义样式 title：'标题'
                          area: ['500px', '300px'],//弹出层的宽高 默认自适应
                          //offset: ['100px', '200px'],//默认垂直水平居中  当您top、left都要定义时，你可以offset: ['100px', '200px']。除此之外，你还可以定义offset: 'rb'，表示右下角。其它的特殊坐标，你可以自己计算赋值。
                          shade: [0.8, '#393D49'],//弹层外区域。默认是0.3透明度的黑色背景（'#000'）。如果你想定义别的颜色，可以shade: [0.8, '#393D49']；如果你不想显示遮罩，可以shade: 0
                          shadeClose: false, //如果你的shade是存在的，那么你可以设定shadeClose来控制点击弹层外区域关闭。默认值false
                          closeBtn: 1,//layer提供了两种风格的关闭按钮，可通过配置1和2来展示，如果不显示，则closeBtn: 0
                          btn: ['确定卖出', '取消'],
                          //time: 5000,//默认不会自动关闭。当你想自动关闭时，可以time: 5000，即代表5秒后自动关闭
                          shift:2,//我们的出场动画全部采用CSS3目前shift可支持的动画类型有0-6
                          maxmin: true,//该参数值对type:1和type:2有效
                          yes: function(index, layero){
                            pay_pwd=$('#pay_pwd').val();
                            $.ajax({
                                url: 'index.php?app=index&act=for_sell_pwd',
                                type: 'POST',
                                dataType: 'json',
                                data: {pay_pwd: pay_pwd,goods_count:count_tran_in,goods_id:goods_id},
                                success:function(data){
                                    if (data.code!=0) 
                                    {
                                        layer.alert(data.message, {
                                                    title:'警告',
                                                    icon: 2,
                                                    skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                                                },function(index_s){ 
                                                    layer.close(index_s);
                                                });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                                                return;
                                    }
                                    $('#confirm_pwd').val(pay_pwd);
                                    layer.close(index);
                                    //按钮1的回调
                                    layer.msg('提交成功',{icon: 1},{time:5});//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                                    $('#myForm').attr('action','index.php?app=index&act=produce_sell');
                                    //表单提交
                                    $("#myForm").submit();
                                }    

                            })
                            .fail(function() {
                                console.log("error");
                                layer.alert('请求异常！请重试！', {
                                                    title:'警告',
                                                    icon: 2,
                                                    skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                                                },function(index_s){ 
                                                    layer.close(index_s);
                                                });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                                                return;

                            });
                            },
                          btn2: function(index, layero){
                            //按钮2的回调
                            layer.close(index);
                             setTimeout("set_continue()",2000);
                          },
                          cancel: function(){ 
                            // alert("点击右上角关闭的回调");
                             setTimeout("set_continue()",2000);
                          },
                          content: '\<\div style="padding:30px 30px 0;">\<\lable style="font: 100 16px/25px \'Microsoft Yahei\'">茶叶名称：\<\/lable>\<\span style="font:100 14px/25px \'Microsoft Yahei\'">'+outdata.data.goods_name+'\<\/span>\<br\/>\<\lable style="font: 100 16px/25px \'Microsoft Yahei\'">茶叶数量：\<\/lable>\<\span style="font:100 14px/25px \'Microsoft Yahei\'">'+count_tran_in+'\<\span>\<br\/>'+
                            '\<\lable style="font: 100 16px/25px \'Microsoft Yahei\'">茶叶单价：\<\/lable>\<\span style="font:100 14px/25px \'Microsoft Yahei\'">'+input_price+'\<\span>\<br\/>'+
                            '\<\lable style="font: 100 16px/25px \'Microsoft Yahei\'">金额合计：\<\/lable>\<\span style="font:100 14px/25px \'Microsoft Yahei\'">'+total_count+'\<\span>\<br\/>'+
                            '\<span id="haha" style="font: 100 16px/25px \'Microsoft Yahei\'">支付密码：\<\/span><input id="pay_pwd" type="password" style="border:1px solid #aaa;font: 100 16px/25px \'Microsoft Yahei\'" maxlength="6"\/>' 
                          });
                          return;
                        //end
                    }
                }) 
            }else{
                $.ajax({
                    url: 'index.php?app=index&act=get_goods_name',
                    type: 'POST',
                    dataType: 'json',
                    data: {goods_id: goods_id},
                    success:function(outdata){
                        if (outdata.code!=0) {
                           alert(outdata.message); 
                           return;
                        }
                        $(this).attr("disabled", true); 
                          //open弹出一个页面层
                        layer.open({
                          type: 1,//0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）。 若你采用layer.open({type: 1})方式调用，则type为必填项（信息框除外）
                          title: ['【买入】茶叶交易订单确认', 'font-size:18px;'],//如果你不想显示标题栏，你可以title: false  不想自定义样式 title：'标题'
                          area: ['500px', '300px'],//弹出层的宽高 默认自适应
                          //offset: ['100px', '200px'],//默认垂直水平居中  当您top、left都要定义时，你可以offset: ['100px', '200px']。除此之外，你还可以定义offset: 'rb'，表示右下角。其它的特殊坐标，你可以自己计算赋值。
                          shade: [0.8, '#393D49'],//弹层外区域。默认是0.3透明度的黑色背景（'#000'）。如果你想定义别的颜色，可以shade: [0.8, '#393D49']；如果你不想显示遮罩，可以shade: 0
                          shadeClose: false, //如果你的shade是存在的，那么你可以设定shadeClose来控制点击弹层外区域关闭。默认值false
                          closeBtn: 1,//layer提供了两种风格的关闭按钮，可通过配置1和2来展示，如果不显示，则closeBtn: 0
                          btn: ['确定支付', '取消'],
                          //time: 5000,//默认不会自动关闭。当你想自动关闭时，可以time: 5000，即代表5秒后自动关闭
                          shift:2,//我们的出场动画全部采用CSS3目前shift可支持的动画类型有0-6
                          maxmin: true,//该参数值对type:1和type:2有效
                          yes: function(index, layero){
                            pay_pwd=$('#pay_pwd').val();
                            $.ajax({
                                url: 'index.php?app=index&act=for_ajax_pwd',
                                type: 'POST',
                                dataType: 'json',
                                data: {pay_pwd: pay_pwd,user_money:total_count},
                                success:function(data){
                                    if (data.code!=0) 
                                    {
                                        layer.alert(data.message, {
                                                    title:'警告',
                                                    icon: 2,
                                                    skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                                                },function(index_s){ 
                                                    layer.close(index_s);
                                                });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                                                return;
                                    }
                                    $('#confirm_pwd').val(pay_pwd);
                                    layer.close(index);
                                    //按钮1的回调
                                    layer.msg('提交成功',{icon: 1},{time:5});//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                                    //表单提交
                                      $('#myForm').attr('action','index.php?app=index&act=transaction');
                                    $("#myForm").submit();
                                }    

                            })
                            .fail(function() {
                                console.log("error");
                                layer.alert('请求异常！请重试！', {
                                                    title:'警告',
                                                    icon: 2,
                                                    skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                                                },function(index_s){ 
                                                    layer.close(index_s);
                                                });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                                                return;

                            });
                            },
                          btn2: function(index, layero){
                            //按钮2的回调
                            layer.close(index);
                             setTimeout("set_continue()",2000);
                          },
                          cancel: function(){ 
                            // alert("点击右上角关闭的回调");
                             setTimeout("set_continue()",2000);
                          },
                          content: '\<\div style="padding:30px 30px 0;">\<\lable style="font: 100 16px/25px \'Microsoft Yahei\'">茶叶名称：\<\/lable>\<\span style="font:100 14px/25px \'Microsoft Yahei\'">'+outdata.data+'\<\/span>\<br\/>\<\lable style="font: 100 16px/25px \'Microsoft Yahei\'">茶叶数量：\<\/lable>\<\span style="font:100 14px/25px \'Microsoft Yahei\'">'+count_tran_in+'\<\span>\<br\/>'+
                            '\<\lable style="font: 100 16px/25px \'Microsoft Yahei\'">茶叶单价：\<\/lable>\<\span style="font:100 14px/25px \'Microsoft Yahei\'">'+input_price+'\<\span>\<br\/>'+
                            '\<\lable style="font: 100 16px/25px \'Microsoft Yahei\'">金额合计：\<\/lable>\<\span style="font:100 14px/25px \'Microsoft Yahei\'">'+total_count+'\<\span>\<br\/>'+
                            '\<span id="haha" style="font: 100 16px/25px \'Microsoft Yahei\'">支付密码：\<\/span><input id="pay_pwd" type="password" style="border:1px solid #aaa;font: 100 16px/25px \'Microsoft Yahei\'" maxlength="6"\/>' 
                          });
                          return;
                        //end
                    }
                })   
            }
          /*  $(this).attr("disabled", true); 

            layer.msg('提交成功',{icon: 1},{time:5});//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
             //表单提交
            $("#myForm").submit();
            setTimeout("set_continue()",2000);*/
        });      
    })

    //返回当前选中的买入还是卖出
    function get_choose(){
        var t= $('#sell_in').attr('checked_cho');
            if (t=='checked') {
                return 1;
            }
            return 2;
    }
    function set_continue(){
        $('#submit_aply').attr("disabled", false); 
    }
    function autoScroll(obj, ul_bz){
        $(obj).find(ul_bz).animate({
            marginTop : "-100px"
            },900,function(){
        $(this).css({marginTop : "0px"}).find("li:first").appendTo(this);
            });
    }
    var st_int=setInterval('autoScroll("#oDiv", "#oUl")',3000);
    $("#oDiv").mouseover(function(){
        clearInterval(st_int);
    })
      $("#oDiv").mouseout(function(){
        st_int=setInterval('autoScroll("#oDiv", "#oUl")',3000);
    });
    $('#input_price').on('keyup',function(){
        var temp=$(this).val().replace(/[^\d.]/g,''); 
        $(this).val(temp);
    });

    $('#input_price').on('change', function(event) {
        event.preventDefault();
         var temp=$(this).val().replace(/[^\d.]/g,''); 
        $(this).val(temp);
        /*买卖价格：不高于涨停价，不低于跌停价*/
        //涨停价格
        var kpan= $('.share_price_count').eq('0').html();
        var zht= $('.share_price_count').eq('6').html();
        var dting= $('.share_price_count').eq('7').html();
        if (kpan==''||zht==undefined||kpan=='--'||zht=='--') {
            /* $('#input_price').val('');
            layer.alert('请优先选择商品！', {
                                title:'警告',
                                icon: 2,
                                skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                            },function(index){ 
                                $('#close_produce').click(); 
                                layer.close(index);  
                                return;
                            });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6*/
            return;
        }
        kpan=parseFloat(kpan);
        dting=parseFloat(dting);
        zht=parseFloat(zht);
        var min_price=kpan*(1-0.1);
        var max_price=kpan*(1+0.1);
        min_price=min_price.toFixed(3);
        max_price=max_price.toFixed(3);
        max_price = parseFloat(max_price);
        min_price = parseFloat(min_price);
        if (zht>0&&zht<max_price) {
            max_price=zht;
        }
        if (dting>0&&dting>min_price) {
            min_price=dting;
        }
        var input_price=$(this).val();
        input_price=parseFloat(input_price);
        if (input_price>max_price||input_price<min_price) {
            show_message='当前价格区间为'+min_price+"—"+max_price;
            $('#input_price').val('');
            layer.alert(show_message, {
                                title:'警告',
                                icon: 2,
                                skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                            },function(index){ 
                                $('#close_produce').click(); 
                                layer.close(index);
                                
                                return;
                            });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
            return;
            }

    });
    $('#count_tran_in').on('keyup',function(){
        var temp=$(this).val().replace(/[^\d]/g,''); 
        $(this).val(temp);
    })
    /*数量输入监听*/
    $('#count_tran_in').on('change',function(event){
        event.preventDefault();
        var temp=$(this).val().replace(/[^\d]/g,''); 
        $(this).val(temp); 
        var sell_count=$('#sell_count').val();
        if (sell_count=='') {
           /* $('#count_tran_in').val(''); */
          /*  layer.alert('请优先选择商品', {
                                title:'警告',
                                icon: 2,
                                skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                            },function(index){
                                
                                layer.close(index);
                            });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6*/
                        return;
        }
         count_tran_in= $(this).val();
        count_tran_in= parseInt(count_tran_in);
        sell_count=parseInt(sell_count);
         choose_status=get_choose();
        if (choose_status==2&&count_tran_in>sell_count) {
            $(this).val(sell_count);
            layer.alert('商品数量最多可选'+sell_count, {
                                title:'警告',
                                icon: 2,
                                skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                            },function(index){
                                
                                layer.close(index);
                            });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
            return;
        }
         if(count_tran_in==0){
            $(this).val('');
            layer.alert('数量不能为空', {
                                title:'警告',
                                icon: 2,
                                skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                            },function(index){
                                
                                layer.close(index);
                            });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
            return;
        }
        
     
    })

var temp_value;

$('#serch_content').on('keyup change',function(event){
    serch_content=$(this).val();
    if (event.type=='change') {
        if (temp_value==serch_content) {
            return;
        }
    }else{
      temp_value=serch_content; 
    }
    $("#prodece_info").css('display','none');

    if (serch_content=='') {
        $("#prodece_out").css('display','none');
        $("#transaction_nav").css('display','');
        return;
    }
    $('#sell_in').click();
    /*
    return;*/
    $.ajax({
        url: 'index.php?app=index&act=get_tea_goods',
        type: 'post',
        dataType: 'json',
        data: {tea_name:serch_content },
        success:function(out_data){
            if (out_data.code!=0) {       
                layer.alert(out_data.message, {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            layer.close(index);
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                    return;
            }else{
                $("#transaction_nav").css('display','none');
                $("#produce_con").css('display','');
                $("#prodece_out").css('display','');
                //移除重新绘画
                /*$("#produce_con table").remove();*/
                var con_str_head='<table>';
                var con_str_body='';
                var count_temp=1;
                if (!out_data.data) {
                    con_str_body='<tr><td colspan="100" style="color:red;height:200px;width:745px;text-align:center">没有此茶哦！！</td>';
                }else{
                   $.each(out_data.data,function(index,value){
                       /* alert(value.goods_name);*/
                       con_str_body +='<tr class="new_tr" goods_id="'+value.goods_id+'"><td>T00'+value.goods_id+'</td><td class="tea_name">'+value.goods_name+'</td><td>'+value.type_des+'</td></tr>';
                         /*if (count_temp%4==0) {
                            con_str_body +='</tr><tr>';
                         }*/
                         
                        count_temp++;
                    });  
                }          
                con_str=con_str_head+con_str_body+'</tr></table>';         
                $("#produce_con").html(con_str);/*$.each()*/
            }
        }
    })
})
/*查询事件加监听*/
$(document).on('click','.new_tr',function(event) {
        //初始化价格和数量
        $('#input_price').val('');
        $('#count_tran_in').val('');
        goods_id=$(this).attr('goods_id');
        $('#goods_id').val(goods_id);
        tea_type=$(this).children('td').eq(2).html();  
        serch_content=$(this).children('td').eq(1).html();  
        /*发送ajax请求查询出当前茶叶风向标的价格*/
        $.ajax({
            url: '?index.php?app=index&act=get_drogue_by_id',
            type: 'GET',
            dataType: 'json',
            data: {goods_id: goods_id},
            success:function(out_data){
                if (out_data.code!=0) {
                     layer.alert(out_data.message, {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            layer.close(index);
                            return;
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                    return;
                }
                //请求成功
                var tea_price=out_data.data;
                /*if (tea_price['transaction_count']==0) {
                    layer.alert('茶叶数量不足请重新选择！', {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            layer.close(index);
                            return;
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                    return;
                }*/
                $('#serch_content').val(serch_content);
                $('#tea_price').html(tea_price['real_price']);
                /*
                {"code":0,"message":"\u8bf7\u6c42\u6210\u529f","data":{"real_price":"7850.50","kai_pan_price":"8000.00"
,"transaction_count":"100","new_price":"--","max_price":"--","min_price":"--","zhangfu_price":"--","zhangdie_price"
:"--","zhangting_price":8800,"dieting_price":7200,"shoupan_price":"8000.00","sell_pan":[{"transaction_price"
:"--","transaction_count":"--"},{"transaction_price":"--","transaction_count":"--"},{"transaction_price"
:"--","transaction_count":"--"},{"transaction_price":"--","transaction_count":"--"},{"transaction_price"
:"--","transaction_count":"--"}],"buy_pan":[{"transaction_price":"--","transaction_count":"--"},{"transaction_price"
:"--","transaction_count":"--"},{"transaction_price":"--","transaction_count":"--"},{"transaction_price"
:"--","transaction_count":"--"},{"transaction_price":"--","transaction_count":"--"}]}}
                 */
                /*左侧盘交易价格*/
                $('.share_price_count').eq(0).html(tea_price['kai_pan_price']);
                $('.share_price_count').eq(1).html(tea_price['new_price']);
                $('.share_price_count').eq(2).html(tea_price['max_price']);
                $('.share_price_count').eq(3).html(tea_price['min_price']);
                $('.share_price_count').eq(4).html(tea_price['zhangfu_price']);
                $('.share_price_count').eq(5).html(tea_price['zhangdie_price']);
                $('.share_price_count').eq(6).html(tea_price['zhangting_price']);
                $('.share_price_count').eq(7).html(tea_price['dieting_price']);
                $('.share_price_count').eq(8).html(tea_price['shoupan_price']);
                $('#sell_count').val(tea_price['transaction_count']);
               /* $('#count_tran_in').val(tea_price['transaction_count']); */
               /* $('.share_price_count').eq(8).html(tea_price['sell_pan']);*/
               /*右侧盘交易价格*/
                $.each(tea_price['sell_pan'],function(index,el){
                    
                    $('.cent_dian').eq(index).html(el.transaction_price);
                    $('.final_dian').eq(index).html(el.transaction_count);
                });
                $.each(tea_price['buy_pan'],function(index1,el1){
                    $('.cent_dian').eq(index1+5).html(el1.transaction_price);
                    $('.final_dian').eq(index1+5).html(el1.transaction_count);
                }); 
                $('#tea_type').html(tea_type); 
                $('#tea_type_hidden').val(tea_type);
                if (tea_price['real_price']=='') {
                    layer.alert('很抱歉此茶已经下架，请重新选择！', {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            $('#close_produce').click(); 
                            layer.close(index);
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
                    return;
                }
                //设置开盘价格
                //触发点击事件提交,生成百度曲线图
                $('#commit_date').click();     
            }
        })         
});

$(document).on('click', '#close_produce_re', function(event) {
    $('#close_produce').click();  
});
$('#close_produce').on('click',function(){
    $("#prodece_out").css('display','none');
    $("#prodece_info").css('display','none');
    $("#transaction_nav").css('display','');
})

</script>

<script type="text/javascript">
    //echart
    // 路径配置
    //echarts: 'http://echarts.baidu.com/build/dist'    
    require.config({
                    paths: {
                    echarts: 'http://echarts.baidu.com/build/dist'
                    }
                });
   
    function show_echart(option){
        require(
            [
                'echarts',
                'echarts/chart/line', 
               /* 'echarts/chart/bar',*/ // 使用柱状图就加载bar模块，按需加载
            ],
            function (ec) {
                // 基于准备好的dom，初始化echarts图表
                var myChart = ec.init(document.getElementById('main')); 
        
                // 为echarts对象加载数据 
                myChart.setOption(option); 
            }
        );
    }
    var drogue={$drogue};
         var data_length=drogue.length;
                if (data_length>0) {
                    //取出所有的价格
                    var total_price=0;
                    var data_r=new Array();
                    var labels=new Array(); 
                    var data=new Array();
                    for(var i=0; i<data_length;){
                        total_price+=parseFloat(drogue[i].real_price);
                         var unixTimestamp = new Date(drogue[i].show_date * 1000);
                          commonTime = unixTimestamp.toLocaleString()
                          commonTime= commonTime.substr(0,10); 
                          char_w=commonTime.substr(commonTime.length-1,1);   
                          if (char_w=="/") {
                            commonTime=commonTime.substring(0,commonTime.length-1);
                          }
                        labels[i]=commonTime;
                        data[i]=drogue[i].real_price;
                        i++;
                    } 
                    data_r["labels"]=labels;
                    data_r["data"]=data;
                    //求出平均价格数
                    pre_price=total_price/data_length;
                    avg_price= parseInt(pre_price);
                    //求底部的起始价格： 起始价格=平均价格*（1-0.05）
                    start_price=avg_price*(1-0.04);
                    start_price=Math.floor(start_price/10)*10;
                    //求顶部的价格： 顶部价格=平均价格*（1+0.05）；
                    end_price=avg_price*(1+0.04);
                    end_price=Math.ceil(end_price/10)*10;
                    //每个格子代表多少： 一格代表的多少=（顶部价格-起始价格）/格子的数量
                    one=(end_price-start_price)/10;
                }
    //启动
    var  option = {
                    title : {
                        text: '茶叶价格走势图',
                        subtext: '单位：元'
                    },
                    tooltip : {
                        trigger: 'axis'
                    },
                    legend: {
                        data:['价格曲线']
                    },
                    toolbox: {
                        show : false,
                        feature : {
                            mark : {show: true},
                            dataView : {show: true, readOnly: false},
                            magicType : {show: true, type: ['line', 'bar']},
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : false,
                            data : data_r["labels"]//['周一','周二','周三','周四','周五','周六','周日']
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            min  :  start_price,
                            max  :  end_price,
                            splitNumber:10,
                            axisLabel : {
                                formatter: '{value} 元'
                            }
                        }
                    ],
                    series : [
                        {
                            name:'价格曲线',
                            type:'line',
                            data:data_r["data"],//[11, 11, 15, 13, 12, 13, 10],
                            symbol:'none',//坐标点显示
                            markPoint : {
                                data : [
                                    {type : 'max', name: '最大值'},
                                    {type : 'min', name: '最小值'}
                                ],
                                effect :{
                                   
                                       show: false,color:'red'
                                }    
                                
                            },
                            markLine : {
                                data : [
                                    {type : 'average', name: '平均值'}
                                ]
                            }
                        }
                       /* {
                            name:'最低气温',
                            type:'line',
                            data:[1, -2, 2, 5, 3, 2, 0],
                            markPoint : {
                                data : [
                                    {name : '周最低', value : -2, xAxis: 1, yAxis: -1.5}
                                ]
                            },
                            markLine : {
                                data : [
                                    {type : 'average', name : '平均值'}
                                ]
                            }
                        }*/
                    ]
        };
    setTimeout(function(){
        show_echart(option)
       }, 0);
              
      
   //echart
    $(document).on("click",'#commit_date',function(event) {
        var begin=$("#begin_day1").val();
        var begin_unix=get_unix_time(begin);
        var end=$("#end_day1").val();
        var end_unix=get_unix_time(end);
        var serch_method=$("#serch_method").val();
        var timestamp1 = Date.parse(new Date()); 
        if (parseInt(begin_unix)>timestamp1/1000) {
            alert("起始时间超时");
            return;
        }
        var myDate =  Date.parse( new Date());
        if (end_unix>=myDate/1000) { 
             alert("结束日期，最大可选择当前日期的前一天！");
            return;
        }
        goods_id=$("#goods_id").val();
        $.ajax({
            url: "{$site_url}/index.php?app=goods&act=get_goodsinfo&id="+goods_id,    //请求的url地址
            dataType: "json",   //返回格式为json
            async: true, //请求是否异步，默认为异步，这也是ajax重要特性
            data: { "begin_unix": begin_unix,
                    "end_unix"  : end_unix,
                    "serch_method":serch_method},    //参数值
            type: "GET",   //请求方式
            beforeSend: function() {
                //请求前的处理
            },
            success: function(req) {
                if (req.code!=0) {
                    alert(req.message);
                    return;
                }
               $("saveEchart").append('<div class="container" id="main" style="height:270px;width:540px;margin: 0 auto;"></div>');
                //请求成功时处理
                //1.设置格子的宽度
                var data_length=req.data.length;
                if (data_length>0) {
                    //取出所有的价格
                    var total_price=0;
                    var data_r=new Array();
                    var labels=new Array(); 
                    var data=new Array();
                    for(var i=0; i<data_length;){
                        total_price+=parseFloat(req.data[i].real_price);
                         var unixTimestamp = new Date(req.data[i].show_date * 1000);
                          commonTime = unixTimestamp.toLocaleString()
                          commonTime= commonTime.substr(0,10); 
                          char_w=commonTime.substr(commonTime.length-1,1);   
                          if (char_w=="/") {
                            commonTime=commonTime.substring(0,commonTime.length-1);
                          }else if (char_w=="上") {
                            commonTime=commonTime.substring(0,commonTime.length-1);
                          }
                        labels[i]=commonTime;
                        data[i]=req.data[i].real_price;
                        i++;
                    }   
                    data_r["labels"]=labels;
                    data_r["data"]=data;
                    //求出平均价格数
                    pre_price=total_price/data_length;
                    avg_price= parseInt(pre_price);
                    //求底部的起始价格： 起始价格=平均价格*（1-0.05）
                    start_price=avg_price*(1-0.04);
                    start_price=Math.floor(start_price/10)*10;
                    //求顶部的价格： 顶部价格=平均价格*（1+0.05）；
                    end_price=avg_price*(1+0.04);
                    end_price=Math.ceil(end_price/10)*10;
                    //每个格子代表多少： 一格代表的多少=（顶部价格-起始价格）/格子的数量
                    one=(end_price-start_price)/10;
                    //1.设置x轴坐标
                    data_r['scaleStepWidth']=one;
                    data_r['scaleStartValue']=start_price;
                    echarts_titile=$('#serch_content').val();

                     //启动
                    var  option = {
                                    title : {
                                        text: echarts_titile,
                                        subtext: '单位：元'
                                    },
                                    tooltip : {
                                        trigger: 'axis'
                                    },
                                  
                                    xAxis : [
                                        {
                                            type : 'category',
                                            boundaryGap : false,
                                            data : data_r["labels"]//['周一','周二','周三','周四','周五','周六','周日']
                                        }
                                    ],
                                    yAxis : [
                                        {
                                            type : 'value',
                                            min  :  start_price,
                                            max  :  end_price,
                                            splitNumber:10,
                                            axisLabel : {
                                                formatter: '{value} 元'
                                            }
                                        }
                                    ],
                                    series : [
                                        {
                                            name:'价格曲线',
                                            type:'line',
                                            data:data_r["data"],//[11, 11, 15, 13, 12, 13, 10],
                                            symbol:'none',//坐标点显示
                                            markPoint : {
                                                data : [
                                                    {type : 'max', name: '最大值'},
                                                    {type : 'min', name: '最小值'}
                                                ],
                                                effect :{
                                                   
                                                       show: false,color:'red'
                                                }    
                                                
                                            },
                                            markLine : {
                                                data : [
                                                    {type : 'average', name: '平均值'}
                                                ]
                                            }
                                        }
                                
                                    ]
                        };
                    show_echart(option);
                }
            },
            complete: function() {
                $("#prodece_out").hide();
                $("#prodece_info").css('display','');
                /*alert('haha');*/
                //请求完成的处理
            },
            error: function() {
                //请求出错处理
            }
        });
    });
   

    /**
     * [get_unix_time 获取时间戳]
     * @param  {[type]} dateStr [时间字符串]
     * @return {[type]}         [description]
     */
    function get_unix_time(dateStr)
    {
        var newstr = dateStr.replace(/-/g,'/'); 
        var date =  new Date(newstr); 
        var time_str = date.getTime().toString();
        return time_str.substr(0, 10);
    }



/*买入卖出监听*/

$('#sell_in').on('click',function(){
    $('#sell_out').attr('checked_cho','false');
    $(this).attr('checked_cho','checked');
   /* $('#fanwei').css('display','none');*/
})
$('#sell_out').on('click',function(){
    $('#sell_in').attr('checked_cho','false');
   /* $('#fanwei').css('display','');*/
    $(this).attr('checked_cho','checked');
    //卖出的时候要做校验是否有该商品，数量是够卖出
    goods_id= $('#goods_id').val();
    if (goods_id==''||goods_id==undefined) {
          layer.alert('请优先选择商品！', {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            $('#sell_in').click(); 
                            layer.close(index);
                           
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6
          return;
    }

    //发送ajax请求检查当前用户该商品的库存
    $.ajax({
       url: 'index.php?app=index&act=check_current_stock',
       type: 'POST',
       dataType: 'json',
       data: {goods_id: goods_id},
       success:function(out_data){
            if (out_data.code!=0) {
                   layer.alert(out_data.message, {
                            title:'警告',
                            icon: 2,
                            skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
                        },function(index){ 
                            $('#sell_in').click(); 
                            layer.close(index);
                        });//默认没有图标 当你想显示图标时，默认皮肤可以传入0-6 
                   return;
            }
            //设置要卖出的数量
           $('#sell_count').val(out_data.data.goods_count);

       }
    })
   
   
    
})
</script>